flowchart TD
    INPUT["ğŸ“„ Input ExtraÃ­do<br/>JSON Estruturado"] --> SUPERVISOR["ğŸ§  Supervisor de<br/>Complexidade"]
    
    SUPERVISOR -->|"Simples"| FAST["âš¡ Agente RÃ¡pido<br/>Gemini 2.5 Flash"]
    SUPERVISOR -->|"Complexo"| ROUTER["ğŸ”€ Roteador<br/>de MatÃ©ria"]
    
    ROUTER -->|"CÃ­vel"| CIVEL["ğŸ‘¨â€âš–ï¸ Agente CÃ­vel<br/>Claude Sonnet 4"]
    ROUTER -->|"Penal"| PENAL["ğŸ‘¨â€âš–ï¸ Agente Penal<br/>Claude Sonnet 4"]
    ROUTER -->|"Trabalhista"| TRAB["ğŸ‘¨â€âš–ï¸ Agente Trabalhista<br/>Claude Sonnet 4"]
    ROUTER -->|"TributÃ¡rio"| TRIB["ğŸ‘¨â€âš–ï¸ Agente TributÃ¡rio<br/>Claude Sonnet 4"]
    
    CIVEL --> RAG["ğŸ” RAG Engine<br/>pgvector + Few-Shot"]
    PENAL --> RAG
    TRAB --> RAG
    TRIB --> RAG
    FAST --> RAG
    
    RAG -->|"Precedentes<br/>Injetados"| GENERATOR["ğŸ“ Gerador de Minuta<br/>Claude Opus 4"]
    
    GENERATOR --> VALIDATOR["âœ… Validador de Output<br/>Zod / Pydantic"]
    
    VALIDATOR -->|"âœ… VÃ¡lido"| HITL["ğŸ‘¤ Human-in-the-Loop<br/>RevisÃ£o do Advogado"]
    VALIDATOR -->|"âŒ InvÃ¡lido"| RETRY["ğŸ”„ Retry<br/>com feedback"]
    RETRY --> GENERATOR
    
    HITL -->|"Aprovado"| EXPORT["ğŸ“¥ Exportar DOCX"]
    HITL -->|"Revisado"| GENERATOR
    HITL -->|"Rejeitado"| ROUTER
    
    subgraph "Observabilidade"
        LS["ğŸ“ˆ LangSmith<br/>Chain-of-Thought Logging"]
    end
    
    SUPERVISOR -.-> LS
    CIVEL -.-> LS
    PENAL -.-> LS
    TRAB -.-> LS
    TRIB -.-> LS
    GENERATOR -.-> LS
    
    style INPUT fill:#4CAF50,color:#fff
    style SUPERVISOR fill:#9C27B0,color:#fff
    style GENERATOR fill:#2196F3,color:#fff
    style HITL fill:#FF9800,color:#fff
    style EXPORT fill:#4CAF50,color:#fff
